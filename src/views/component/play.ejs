<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เล่น</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet" />
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6579807593228261"
        crossorigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../css/index.css">
    <link rel="stylesheet" href="../css/acticle.css">
    <link rel="stylesheet" href="../css/play.css">
    <link rel="stylesheet" href="../css/footer.css">
    <link rel="stylesheet" href="../css/font/font1.css">
    <link rel="stylesheet" href="../css/pages/video_player.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.8.1/slick.css" />
    <script type="text/javascript" src="/js/index.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick-theme.min.css"
        integrity="sha512-17EgCFERpgZKcm0j0fEq1YCJuyAWdz9KUtv1EjVuaOz8pDnh/0nZxmU6BBXwaaxqoi9PQXnRWqlcDB027hgv9A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.9.0/slick.min.css"
        integrity="sha512-yHknP1/AwR+yx26cB1y0cjvQUMvEa2PFzt1c9LlS4pRQ5NOTZFWbhBig+X9G9eYW/8m0/4OXNx8pxJ6z57x0dw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Icons" rel="stylesheet" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <script src="//imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
    <script async src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
    <script>
        window.googletag = window.googletag || { cmd: [] };
        googletag.cmd.push(function () {
            googletag.defineSlot('/22745653040/AniNightads', [120, 20], 'div-gpt-ad-1710925870938-0').addService(googletag.companionAds()).addService(googletag.pubads());
            googletag.pubads().enableSingleRequest();
            googletag.pubads().enableVideoAds();
            googletag.companionAds().setRefreshUnfilledSlots(true);
            googletag.enableServices();
        });
    </script>
</head>

<body>
    <div class="fixed inset-x-0 z-20" id="navbar">
        <%- include('../navbar') %>
    </div>
    <section class="playsec mx-auto xl:max-w-7xl pt-[110px]">
        <div class="container-play">
            <section class="section-player">
                <div class="container">
                    <div class="video_player">
                        <video webkit-playsinline playsinline preload="metadata" class="main-video" id="video">
                            <source src="/videos/<%= video.filePath %>.mp4" size="720" type="video/mp4">

                            <% if (video.subthai) { %>
                                <track default label="ซับไทย" kind="subtitles" src="<%= video.subthai %>" srclang="th">
                                <% } else { %>
                                    <track default label="ซับไทย" kind="subtitles" src="../subtitles/mosawoth.vtt"
                                        srclang="th">
                                    <% } %>


                                        <!-- <audio id="audio" src="./audip_th.wav"></audio>

                            <select id="audioSelect">
                                <option value="./audip_th.wav" selected>เสียงพากย์ภาษาไทย</option>
                                <option value="./audip_en.wav">เสียงพากย์ภาษาอังกฤษ</option>
                                <option value="./audip_jp.wav">เสียงพากย์ภาษาญี่ปุ่น</option>
                            </select> -->
                        </video>
                        <div id="adContainer"></div>
                        <!-- /22745653040/AniNightads -->
                        <div id='div-gpt-ad-1710925870938-0' style='min-width: 120px; min-height: 20px;'>
                            <script>
                                googletag.cmd.push(function () { googletag.display('div-gpt-ad-1710925870938-0'); });
                            </script>
                        </div>
                    </div>

                </div>
                <div class="mt-8 w-full bg-white px-6 md:px-12 py-4 shadow-md rounded-md relative">
                    <h2 style="font-size: 20px; font-weight: bold;">ความคิดเห็น</h2>
                </div>
            </section>
            <div class="info">
                <amp-ad width=640 height=480 type="doubleclick" data-slot="/22745653040/AniNight-004"
                    data-multi-size="400x300">
                </amp-ad>
                <div class="mt-8 bg-white px-6 md:px-12 py-4 shadow-md rounded-md relative">
                    <div class="tages">
                        <% if (video && video.tags && video.tags.length> 0) { %>
                            <h2> <%- video.tags.map(tag=> `<a href="/tag/${tag}">${tag}</a>`).join(', ') %></h2>
                            <% } else { %>
                                <h2>Tags: ไม่มีแท็ก</h2>
                                <% } %>
                    </div>
                    <h2 class="text-1xl mt-2 text-center tracking-wider text-gray-700 mt-4">
                        <%= video.name %>
                    </h2>
                    <div class="description bg-gray-50" style="border-radius: 10px; padding: 20px;">
                        <p>
                            <% if(video.description.length <=50) { %>
                                <%= video.description %>
                                    <% } else { %>
                                        <span class="short-text">
                                            <%= video.description.substring(0, 50) %>
                                        </span>
                                        <span class="full-text" style="display: none;">
                                            <%= video.description %>
                                        </span>
                                        <span class="more-btn">ดูเพิ่มเติม</span>
                                        <span class="less-btn" style="display: none;">ย่อ</span>
                                        <% } %>
                        </p>
                    </div>
                    <div class="flex items-center justify-center mt-4">
                        <% if (video && video.createdAt) { %>
                            <p> สร้างเมื่อ : <%= new Date(video.createdAt).toLocaleDateString('en-EN') %>
                            </p>
                            <% } %>
                                <h2 class="pl-[20px]">
                                    <p class="views-pc">การดู <%= video.views %> ครั้ง</p>
                                </h2>
                    </div>
                    <% if (video.author && video.author.id) { %>
                        <!-- ส่วนโปรไฟล์ -->
                        <a href="/editor/<%= video.author.id.username %>">
                            <div class="flex items-center">
                                <div class="mt-1">
                                    <img class="w-[50px] h-[50px] p-1 rounded-full"
                                        src="/profiles/<%= video.author.id.profile %>" alt="">
                                </div>
                                <h2 class="pl-[10px]">
                                    <%= video.author.id.username %>
                                </h2>
                            </div>
                        </a>
                        <% } else { %>
                            <p>Author: Unknown</p>

                            <% } %>
                </div>

                <!-- ส่วนคำอธิบาย -->
                <div class="mt-8 bg-white px-6 md:px-12 py-4 shadow-md rounded-md relative">
                    <h2 class="text-2xl font-bold font-weight-500 mb-[20px]">นักพากย์ไทยและญี่ปุ่น</h2>
                    <ul
                        class="flex flex-wrap text-sm font-medium text-center text-gray-500 border-gray-200 dark:border-gray-700 dark:text-gray-400">
                        <li class="me-2">
                            <a href="#" aria-current="page"
                                class="inline-block p-4 text-white bg-amber-400 rounded-t-lg active dark:bg-gray-800 dark:text-blue-500">นักพากย์ไทย</a>
                        </li>
                        <li class="me-2">
                            <a href="#"
                                class="inline-block p-4 rounded-t-lg hover:text-gray-600 hover:bg-gray-50 dark:hover:bg-gray-800 dark:hover:text-gray-300">นักพากย์ญี่ปุ่น</a>
                        </li>
                    </ul>

                    <div class="ct-1">
                        <div data-v-0a465567 class="row-card view-character-staff">
                            <div data-v-0a465567 class="character">
                                <a data-v-0a465567 href="" class="cover" style="
                                background-image: url(https://m1r.ai/9/l6s1g.png);"></a>
                                <a data-v-0a465567 href="" class="content">
                                    <div data-v-0a465567 class="name">
                                        ชื่อ
                                    </div>
                                </a>
                            </div>
                            <div data-v-0a465567 class="voice">
                                <a data-v-0a465567 href="" class="cover"
                                    style="background-image: url(https://s4.anilist.co/file/anilistcdn/media/anime/cover/large/bx151970-qFKtRhOaSqa0.jpg);"></a>
                                <a data-v-0a465567 href="">
                                    <div data-v-0a465567 class="name">
                                        Name Voice
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </section>
    <%- include('../footer') %>

        <script src="../js/video_player.js"></script>
        <!-- <script src="./js/pages/videoai.js"></script> -->
        <script>
            window.addEventListener('scroll', function () {
                var navbar = document.getElementById('navbar');
                if (window.scrollY > 50) {
                    navbar.classList.add('navbar-white-bg');
                } else {
                    navbar.classList.remove('navbar-white-bg');
                }
            });

        </script>
        <script>
            document.addEventListener("DOMContentLoaded", function () {
                console.log("DOM Content Loaded");

                var player = document.getElementById("video");
                console.log("Video.js player initialized");

                var vastTagPreroll = "https://pubads.g.doubleclick.net/gampad/live/ads?sz=88x31|1x1|400x300&iu=/22745653040/AniNightads&ciu_szs=120x20&env=vp&impl=s&gdfp_req=1&output=vast&unviewed_position_start=1&url=[referrer_url]&description_url=[description_url]&correlator=[timestamp]";
                var vastTagMidroll = "https://pubads.g.doubleclick.net/gampad/live/ads?sz=88x31|1x1|400x300&iu=/22745653040/AniNightads&ciu_szs=120x20&env=vp&impl=s&gdfp_req=1&output=vast&unviewed_position_start=1&url=[referrer_url]&description_url=[description_url]&correlator=[timestamp]";
                var vastTagPostroll = "https://pubads.g.doubleclick.net/gampad/preview_cookie?gct=BEdGq-9lI5kY3ZPqrwYw3a-ftwaIAYCAgOCd3unEVg&op=set&redirect=https://ani-night.online/play/40312?google_preview%3DBEdGq-9lI5kY3ZPqrwYw3a-ftwaIAYCAgOCd3unEVg&redirect_hash=AJlzBa3gUzNSOuVFiD8WjsRZwdQGX1BUow&lineItemId=6645025135&creativeId=138468573645";
                var prerollTriggered = false;
                var postrollTriggered = false;
                var midrollRequested = false;
                var midrollInterval = 5 * 60; // 5 minutes
                var lastMidrollTime = 0; // The time when the last mid-roll ad was played

                if (!prerollTriggered) {
                    player.ima({
                        adTagUrl: vastTagPreroll,
                        showControlsForAds: true,
                        debug: false,
                    });
                } else {
                    player.ima({
                        adTagUrl: '',
                        showControlsForAds: true,
                        debug: false,
                    });
                }
                console.log("IMA settings configured");

                player.ima.initializeAdDisplayContainer();
                console.log("IMA ad display container initialized");

                function requestMidrollAd() {
                    midrollRequested = true;
                    player.ima.changeAdTag(vastTagMidroll);
                    player.ima.requestAds();
                }

                player.on("timeupdate", function () {
                    var currentTime = player.currentTime();
                    console.log("Current time:", currentTime);
                    var timeSinceLastMidroll = currentTime - lastMidrollTime;

                    if (timeSinceLastMidroll >= midrollInterval && !midrollRequested) {
                        lastMidrollTime = currentTime; // Update the last mid-roll ad time
                        console.log("Midroll triggered");
                        requestMidrollAd();
                    }
                });

                player.on("ended", function () {
                    console.log("Video ended");
                    if (!postrollTriggered) {
                        postrollTriggered = true;
                        console.log("Postroll triggered");

                        player.ima.requestAds({
                            adTagUrl: vastTagPostroll,
                        });

                        console.log("Postroll ads requested");
                    }
                });

                player.on("adsready", function () {
                    if (midrollRequested) {
                        console.log("Ads ready - midroll");
                    } else {
                        console.log("Ads ready - preroll");
                        player.src(
                            "path/to/your/video.mp4"
                        );
                    }
                });

                player.on("aderror", function () {
                    console.log("Ads aderror");
                    player.play();
                });

                player.on("adend", function () {
                    if (lastMidrollTime > 0) {
                        console.log("A midroll ad has finished playing.");
                        midrollRequested = false;
                    } else {
                        console.log("The preroll ad has finished playing.");
                        prerollTriggered = true;
                    }
                    player.play();
                });
            });
        </script>
</body>

</html>